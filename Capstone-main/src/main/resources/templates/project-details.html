<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${project.title} + ' - Details'">Project Details</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            --navy: #0a192f;
            --green: #2ecc71;
            --light: #f8f9fa;
        }
        body { background-color: var(--light); padding-top: 80px; font-family: 'Segoe UI', sans-serif; }
        .project-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .project-img { width: 100%; height: 450px; object-fit: cover; }
        .text-navy { color: var(--navy); }
        .bg-navy { background-color: var(--navy); color: white; }
        .progress { height: 12px; border-radius: 10px; }
        .progress-bar { background-color: var(--green); }

        /* Comments Section */
        .comment-box { border-bottom: 1px solid #eee; padding: 15px 0; }
        .comment-avatar {
            width: 45px; height: 45px; background: var(--navy);
            color: white; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-weight: bold;
        }
        .sidebar-card { position: sticky; top: 100px; background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8">
            <div class="project-card animate__animated animate__fadeIn">
                <img th:src="${project.imageUrl != null ? project.imageUrl : 'https://via.placeholder.com/800x450'}" class="project-img" alt="Project">

                <div class="p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="badge bg-success px-3 py-2" th:text="${project.type}">Type</span>
                        <small class="text-muted"><i class="far fa-calendar-alt me-1"></i> Created on <span th:text="${#dates.format(project.createdAt, 'dd MMM yyyy')}">Date</span></small>
                    </div>

                    <h1 class="fw-bold text-navy mb-3" th:text="${project.title}">Project Title</h1>
                    <p class="lead text-secondary" th:text="${project.shortDescription}">Short description</p>

                    <hr class="my-4">

                    <h4 class="fw-bold text-navy mb-3">Project Story</h4>
                    <div class="text-dark" style="line-height: 1.8;" th:text="${project.longDescription}">
                        Full long description goes here...
                    </div>
                </div>
            </div>

            <div class="project-card mt-4 p-4">
                <h4 class="fw-bold text-navy mb-4"><i class="far fa-comments text-green me-2"></i> Discussion</h4>

                <form th:action="@{/projects/{id}/comment(id=${project.id})}" method="post" class="mb-4">
                    <div class="form-group mb-3">
                        <textarea name="content" class="form-control bg-light" rows="3" placeholder="Add a comment..." required></textarea>
                    </div>
                    <button type="submit" class="btn bg-navy px-4">Post Comment</button>
                </form>

                <div class="comments-list">
                    <div th:each="comment : ${project.comments}" class="comment-box d-flex gap-3">
                        <div class="comment-avatar shadow-sm" th:text="${#strings.substring(comment.user.name,0,1)}">U</div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between">
                                <h6 class="fw-bold mb-1 text-navy" th:text="${comment.user.name}">User</h6>
                                <small class="text-muted" th:text="${#temporals.format(comment.createdAt, 'dd MMM, HH:mm')}">Time</small>
                            </div>
                            <p class="mb-0 text-secondary" th:text="${comment.content}">Comment content.</p>
                        </div>
                    </div>
                    <div th:if="${#lists.isEmpty(project.comments)}" class="text-center py-4 text-muted">
                        <p>No comments yet. Start the conversation!</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="sidebar-card">
                <h5 class="fw-bold text-navy mb-3">Funding Progress</h5>
                <h2 class="text-green fw-bold mb-1" th:text="'$' + ${#numbers.formatDecimal(project.raisedAmount, 0, 'COMMA', 0, 'POINT')}">$0</h2>
                <p class="text-muted mb-3">pledged of <span class="fw-bold" th:text="'$' + ${project.fundingGoal}">$0</span></p>

                <div class="progress mb-3">
                    <div class="progress-bar" th:style="'width:' + ${project.fundingPercent} + '%'"></div>
                </div>

                <div class="d-flex justify-content-between mb-4">
                    <div class="text-center">
                        <h5 class="fw-bold mb-0" th:text="${project.fundingPercent} + '%'">0%</h5>
                        <small class="text-muted">Funded</small>
                    </div>
                    <div class="text-center border-start border-end px-3">
                        <h5 class="fw-bold mb-0" th:text="${project.likedUsers.size()}">0</h5>
                        <small class="text-muted">Backers</small>
                    </div>
                    <div class="text-center">
                        <h5 class="fw-bold mb-0" th:text="${project.fundingDuration}">0</h5>
                        <small class="text-muted">Days Left</small>
                    </div>
                </div>

                <a th:href="@{/projects}" class="btn btn-outline-secondary w-100 py-3 fw-bold mb-3 rounded-pill shadow-sm">
                    <i class="fas fa-arrow-left me-2"></i> Back to All Projects
                </a>

                <form th:action="@{/projects/{id}/like(id=${project.id})}" method="post">
                    <button type="submit" class="btn btn-outline-danger w-100 rounded-pill py-2">
                        <i th:class="${project.likedByCurrentUser} ? 'fas fa-heart' : 'far fa-heart'"></i>
                        <span th:text="${project.likedByCurrentUser} ? ' Liked' : ' Like Project'">Like</span>
                    </button>
                </form>

                <div class="mt-4 p-3 bg-light rounded-3 text-center">
                    <small class="text-muted">Project by</small>
                    <h6 class="fw-bold text-navy mt-1" th:text="${project.owner.name}">Owner</h6>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>