<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Projects - OpportuGrow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f8f9fa; padding: 20px; }
        .container { max-width: 1200px; }
        .page-header { background: linear-gradient(135deg,#2c3e50,#1a252f); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; }
        .page-title { font-size: 2.5rem; font-weight: 700; }
        .page-subtitle { opacity: 0.9; }
        .header-actions { margin-top: 20px; display: flex; gap: 15px; }
        .stats-container { display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
        .stat-card { flex: 1; min-width: 200px; background: white; border-radius: 12px; padding: 20px; display: flex; gap: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.08); }
        .stat-icon { width:50px;height:50px;display:flex;align-items:center;justify-content:center;border-radius:12px;color:white;font-size:1.5rem;}
        .icon-total { background: linear-gradient(135deg,#2c3e50,#1a252f); }
        .icon-active { background: linear-gradient(135deg,#2ecc71,#27ae60); }
        .icon-pending { background: linear-gradient(135deg,#f39c12,#e67e22); }
        .icon-completed { background: linear-gradient(135deg,#3498db,#2980b9); }
        .projects-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; margin-bottom: 40px; }
        .project-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border:1px solid #eee; }
        .project-header { padding: 20px; border-bottom: 1px solid #eee; background:#f8f9fa; }
        .project-title { font-size:1.3rem;font-weight:600;color:#2c3e50;margin-bottom:5px; }
        .project-type { display:inline-block;padding:4px 12px;border-radius:20px;font-size:0.8rem;font-weight:600;text-transform:uppercase; margin-bottom:10px; }
        .type-business { background: rgba(52,152,219,0.1); color:#3498db; }
        .type-charity { background: rgba(46,204,113,0.1); color:#2ecc71; }
        .project-body { padding:20px; }
        .project-detail { display:flex; justify-content:space-between; margin-bottom:12px; padding-bottom:12px; border-bottom:1px solid #f5f5f5; }
        .detail-label { color:#666; font-weight:500; font-size:0.9rem; }
        .detail-value { font-weight:600; color:#2c3e50; }
        .project-actions { display:flex; gap:10px; margin-top:20px; padding-top:20px; border-top:1px solid #eee; }
        .action-btn { flex:1; padding:8px 15px; border-radius:8px; font-weight:500; font-size:0.9rem; display:flex; align-items:center; justify-content:center; gap:8px; text-decoration:none; cursor:pointer; border:none; }
        .btn-edit { background: rgba(46,204,113,0.1); color:#2ecc71; }
        .btn-delete { background: rgba(231,76,60,0.1); color:#e74c3c; }
        .btn-edit:hover { background:#2ecc71;color:white; }
        .btn-delete:hover { background:#e74c3c;color:white; }
        .delete-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center; }
        .modal-content { background:white; border-radius:15px; width:90%; max-width:500px; text-align:center; padding:30px; }
        .modal-header { font-size:1.5rem; font-weight:600; margin-bottom:15px; }
        .modal-message { font-weight:600; margin-bottom:20px; }
        .project-name { color:#e74c3c; font-weight:700; }
        .modal-btn { padding:12px 25px; border-radius:10px; border:none; font-weight:600; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:10px; }
        .btn-cancel { background:#f1f1f1; color:#2c3e50; }
        .btn-confirm-delete { background:#e74c3c; color:white; }
        .btn-cancel:hover { background:#ddd; }
        .btn-confirm-delete:hover { background:#c0392b; }
    </style>
</head>
<body>
<div class="container">

    <!-- Page Header -->
    <div class="page-header">
        <div class="d-flex justify-content-between align-items-start">
            <div> <h1 class="page-title"><i class="fas fa-project-diagram me-3">

            </i>My Projects</h1> <p class="page-subtitle">Manage and track all your projects in one place</p>
            </div>
            <a th:href="@{/create-project/choose-type}" class="btn btn-light btn-lg">
                <i class="fas fa-plus me-2"></i>New Project</a>
        </div> <div class="header-actions"> <a th:href="@{/}" class="btn btn-outline-light"><i class="fas fa-home me-2"></i>Home</a>
        <a th:href="@{/projects}" class="btn btn-outline-light"><i class="fas fa-search me-2"></i>Browse All Projects</a>
        <a th:href="@{/profile}" class="btn btn-outline-light"><i class="fas fa-user me-2"></i>My Profile</a>
    </div> </div>
    <!-- Flash Message -->
    <div th:if="${message}" th:class="'alert alert-' + ${messageType} + ' mt-3'" role="alert">
        <span th:text="${message}"></span> </div>
    <!-- Stats -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-icon icon-total"><i class="fas fa-layer-group"></i>
            </div>
            <div class="stat-content">
                <h3 th:text="${totalProjects}">0</h3>
                <p>Total Projects</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon icon-active">
                <i class="fas fa-play-circle"></i>
            </div>
            <div class="stat-content">
                <h3 th:text="${activeProjects}">0</h3><p>Active</p></div>
        </div>
        <div class="stat-card">
            <div class="stat-icon icon-pending"><i class="fas fa-clock"></i>
            </div>
            <div class="stat-content"><h3 th:text="${pendingProjects}">0</h3><p>Pending</p></div></div> <div class="stat-card"><div class="stat-icon icon-completed"><i class="fas fa-check-circle"></i></div><div class="stat-content"><h3 th:text="${completedProjects}">0</h3><p>Completed</p></div></div> </div> <!-- Projects Grid --> <div th:if="${not #lists.isEmpty(projects)}" class="projects-grid"> <div th:each="project : ${projects}" class="project-card"> <div class="project-header"> <div class="d-flex justify-content-between align-items-start"> <div> <h3 class="project-title" th:text="${project.title}">Project Name</h3> <span th:class="'project-type type-' + ${project.type.name().toLowerCase()}" th:text="${project.type.name()}">Type</span> </div> <span th:class="'status-badge status-' + ${project.status.name().toLowerCase()}" th:text="${project.status.name()}">Status</span> </div> </div> <div class="project-body"> <!-- Funding Progress --> <div class="funding-progress" th:if="${project.fundingGoal != null and project.currentFunding != null}"> <div class="progress-info"> <span th:text="'$' + ${#numbers.formatDecimal(project.currentFunding, 0, 2)}">$0</span> <span th:text="'$' + ${#numbers.formatDecimal(project.fundingGoal, 0, 2)}">$0</span> </div> <div class="progress-bar"> <div class="progress-fill" th:style="'width: ' + ${(project.currentFunding / project.fundingGoal) * 100} + '%'"></div> </div> <small class="text-muted" th:text="${#numbers.formatDecimal((project.currentFunding / project.fundingGoal) * 100, 1, 2)} + '% Funded'">0%</small> </div> <!-- Project Details --> <div class="project-detail"> <span class="detail-label">Funding Goal</span> <span class="detail-value" th:text="'$' + ${#numbers.formatDecimal(project.amountYouWillReceive, 0, 2)}">$0</span> </div> <div class="project-detail"><span class="detail-label">Type</span><span class="detail-value" th:text="${project.type}">Type</span></div> <div class="project-detail"><span class="detail-label">Created</span><span class="detail-value" th:text="${#dates.format(project.createdAt,'dd MMM yyyy')}">Date</span></div> <div class="project-detail" th:if="${project.fundingDuration != null}"><span class="detail-label">Deadline</span><td th:text="${project.fundingDuration + ' days'}">Duration</td></div>

                <!-- Actions -->
                <div class="project-actions">
                    <a th:href="@{/projects/edit/{id}(id=${project.id})}" class="btn-edit action-btn">
                        <i class="fas fa-edit"></i> Edit
                    </a>

                    <!-- Delete Form -->
                    <form th:action="@{/projects/delete/{id}(id=${project.id})}" method="post"
                          th:attr="data-title=${project.title}" style="flex:1;">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="button" class="btn-delete action-btn"
                                onclick="showDeleteModal(this.closest('form'))">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="delete-modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-exclamation-triangle"></i> Delete Project
            </div>
            <div class="modal-message">
                Are you sure you want to delete the project: <span id="projectName" class="project-name"></span>?
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" onclick="closeDeleteModal()">Cancel</button>
                <button class="modal-btn btn-confirm-delete" id="confirmDeleteBtn">Delete Project</button>
            </div>
        </div>
    </div>

</div>

<script>
    let currentForm = null;

    function showDeleteModal(form) {
        currentForm = form;
        const projectTitle = form.getAttribute('data-title');
        document.getElementById('projectName').textContent = projectTitle;
        document.getElementById('deleteModal').style.display = 'flex';
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').style.display = 'none';
        currentForm = null;
    }

    document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
        if (currentForm) {
            currentForm.submit(); // ارسال الفورم للbackend
        }
    });

    // Close modal on click outside
    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) closeDeleteModal();
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && document.getElementById('deleteModal').style.display === 'flex') {
            closeDeleteModal();
        }
    });
</script>

</body>
</html>
