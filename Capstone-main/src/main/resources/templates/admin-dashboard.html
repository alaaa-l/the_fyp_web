<div th:fragment="content">
    <style>
        .dashboard-wrapper { animation: fadeIn 0.8s ease-out; }

        /* Stats Cards Enhanced */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card-premium {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            border: 1px solid #f1f5f9;
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card-premium:hover { transform: translateY(-5px); }

        .stat-card-premium::before {
            content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
            background: var(--primary-gradient, #6366f1);
        }

        .stat-label-modern { color: #64748b; font-weight: 600; font-size: 0.9rem; text-transform: uppercase; }
        .stat-value-modern { font-size: 1.8rem; font-weight: 800; color: #1e293b; margin-top: 5px; }

        /* Chart Containers */
        .chart-card {
            background: white;
            border-radius: 24px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border: 1px solid #f1f5f9;
        }
    </style>

    <div class="dashboard-wrapper">
        <div class="page-header">
            <div class="header-title">
                <h1>Platform Analytics</h1>
                <p>Real-time overview of your ecosystem performance</p>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card-premium">
                <div class="stat-label-modern"><i class="bi bi-rocket-takeoff me-2"></i>Total Projects</div>
                <div class="stat-value-modern" th:text="${totalProjects}">0</div>
            </div>
            <div class="stat-card-premium">
                <div class="stat-label-modern"><i class="bi bi-currency-dollar me-2"></i>Total Raised</div>
                <div class="stat-value-modern" th:text="${#numbers.formatCurrency(totalRaised)}">$0</div>
            </div>
            <div class="stat-card-premium">
                <div class="stat-label-modern"><i class="bi bi-people me-2"></i>Active Users</div>
                <div class="stat-value-modern" th:text="${activeUsers}">0</div>
            </div>
            <div class="stat-card-premium">
                <div class="stat-label-modern"><i class="bi bi-graph-up-arrow me-2"></i>Success Rate</div>
                <div class="stat-value-modern" th:text="${successRate} + '%'">0%</div>
            </div>
        </div>

        <div class="row g-4 mb-4">
            <div class="col-lg-8">
                <div class="chart-card">
                    <h5 class="mb-4 fw-bold">Growth Trends (Projects vs Funds)</h5>
                    <div style="height: 350px;">
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="chart-card">
                    <h5 class="mb-4 fw-bold">Project Distribution</h5>
                    <div style="height: 350px;">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // بنستخدم هيدا الـ Event لنتأكد إنو الـ DOM صار جاهز والـ Chart.js تحملت
        document.addEventListener("DOMContentLoaded", function() {
            try {
                const projectsData = [[${projectsPerMonth}]] || [];
                const fundsData = [[${fundsPerMonth}]] || [];
                const monthsLabels = [[${months}]] || [];

                const p = [[${pendingProjects}]] || 0;
                const a = [[${approvedProjects}]] || 0;
                const r = [[${rejectedProjects}]] || 0;

                // Line Chart
                const lineCtx = document.getElementById("lineChart").getContext("2d");
                new Chart(lineCtx, {
                    type: "line",
                    data: {
                        labels: monthsLabels,
                        datasets: [
                            {
                                label: "Projects",
                                data: projectsData,
                                borderColor: "#6366f1",
                                backgroundColor: "rgba(99,102,241,0.1)",
                                fill: true,
                                tension: 0.4,
                                borderWidth: 3,
                                pointRadius: 4
                            },
                            {
                                label: "Funds ($)",
                                data: fundsData,
                                borderColor: "#10b981",
                                backgroundColor: "rgba(16,185,129,0.1)",
                                fill: true,
                                tension: 0.4,
                                borderWidth: 3,
                                pointRadius: 4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: true, position: 'bottom' } },
                        scales: {
                            y: { grid: { display: false } },
                            x: { grid: { display: false } }
                        }
                    }
                });

                // Status Chart (Doughnut)
                const statusCtx = document.getElementById("statusChart").getContext("2d");
                new Chart(statusCtx, {
                    type: "doughnut",
                    data: {
                        labels: ["Pending", "Approved", "Rejected"],
                        datasets: [{
                            data: [p, a, r],
                            backgroundColor: ["#f59e0b", "#10b981", "#ef4444"],
                            hoverOffset: 15,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        },
                        cutout: '70%'
                    }
                });
            } catch (error) {
                console.error("Chart rendering error:", error);
            }
        });
    </script>
</div>
